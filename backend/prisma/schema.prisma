datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model struktur_files {
  id         Int      @id @default(autoincrement())
  nama_file  String
  file_path  String
  created_at DateTime @default(now()) @db.Timestamp(6)
}

model budaya_mutu {
  id         Int      @id @default(autoincrement())
  user_id    Int
  type       String
  data       Json
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  user users @relation(fields: [user_id], references: [id])

  @@index([user_id], map: "idx_budaya_mutu_user")
}

model relevansi_pendidikan {
  id         Int      @id @default(autoincrement())
  user_id    Int
  subtab     String   @db.VarChar(100)
  data       Json // semua data FE masuk ke sini
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  user users @relation(fields: [user_id], references: [id])

  @@index([subtab], map: "idx_relevansi_pendidikan_subtab")
  @@index([user_id], map: "idx_relevansi_pendidikan_user")
}

model relevansi_penelitian {
  id         Int      @id @default(autoincrement())
  user_id    Int
  subtab     String   @db.VarChar(100)
  data       Json // semua data FE masuk ke sini
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  user users @relation(fields: [user_id], references: [id])

  @@index([subtab], map: "idx_relevansi_penelitian_subtab")
  @@index([user_id], map: "idx_relevansi_penelitian_user")
}

model relevansi_pkm {
  id         Int      @id @default(autoincrement())
  user_id    Int
  subtab     String   @db.VarChar(100)
  data       Json // semua data FE masuk ke sini
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  user users @relation(fields: [user_id], references: [id])

  @@index([subtab], map: "idx_relevansi_pkm_subtab")
  @@index([user_id], map: "idx_relevansi_pkm_user")
}

model akuntabilitas {
  id         Int      @id @default(autoincrement())
  user_id    Int
  subtab     String   @db.VarChar(100)
  data       Json // semua data FE masuk ke sini
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  user users @relation(fields: [user_id], references: [id])

  @@index([subtab], map: "idx_akuntabilitas_subtab")
  @@index([user_id], map: "idx_akuntabilitas_user")

  @@map("akuntabilitas")
}

model diferensiasi_misi {
  id         Int      @id @default(autoincrement())
  user_id    Int
  subtab     String   @db.VarChar(100)
  data       Json // semua data FE masuk ke sini
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  user users @relation(fields: [user_id], references: [id])

  @@index([subtab], map: "idx_diferensiasi_misi_subtab")
  @@index([user_id], map: "idx_diferensiasi_misi_user")
}

// =========================
// USERS (AUTH + MANAJEMEN AKUN)
// =========================
model users {
  id               Int       @id @default(autoincrement())
  username         String    @unique @db.VarChar(50)
  email            String    @unique @db.VarChar(100)
  password         String    @db.VarChar(255)
  nama_lengkap     String?   @db.VarChar(255)
  prodi            String?   @db.VarChar(255) // Program Studi
  photo            String?   @db.VarChar(500) // Path atau URL foto
  role             String    @default("TU") @db.VarChar(20) // TU, P4M, Tim Akreditasi
  status           String    @default("aktif") @db.VarChar(20)
  created_at       DateTime  @default(now())
  updated_at       DateTime  @default(now()) @updatedAt

  // Relasi balik
  relevansi_penelitian relevansi_penelitian[]
  relevansi_pkm        relevansi_pkm[]
  relevansi_pendidikan relevansi_pendidikan[]
  akuntabilitas        akuntabilitas[]
  diferensiasi_misi    diferensiasi_misi[]
  budaya_mutu          budaya_mutu[]
  led                  led[]
}

// =========================
// LED (Laporan Evaluasi Diri)
// =========================
model led {
  id         Int      @id @default(autoincrement())
  user_id    Int
  subtab     String   @db.VarChar(100)
  data       Json // semua data FE masuk ke sini
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  user users @relation(fields: [user_id], references: [id])

  @@unique([user_id, subtab], map: "user_id_subtab")
  @@index([subtab], map: "idx_led_subtab")
  @@index([user_id], map: "idx_led_user")

  @@map("led")
}
